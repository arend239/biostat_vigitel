---
title: "Ultraprocessados e Obesidade üå≠üçü"
subtitle: "MAT02268 - Bioestat√≠stica A"
format:
  revealjs:
    slide-number: true
    chalkboard:
      buttons: false
    preview-links: auto
    logo: images/ufrgs.png
    css: style/styles.css
    footer: 'Davi Augusto, Eduardo Garcez e Jo√£o Arend'
---


```{r opt, include = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

```{r lib}

libs <- c(
  "dplyr", "ggplot2", "purrr",
  "stringr", "survey", "broom",
  "gt", "readr", "table1"
)

for (lib in libs) {
  if (!requireNamespace(lib, quietly = TRUE)) {
      install.packages(lib)
    }
  library(lib, character.only = TRUE)
}
```


```{r, base, echo = FALSE, include = FALSE}
library(purrr)
library(stringr)
library(survey)
library(dplyr)
library(broom)
library(readr)
library(table1)
#remove.packages("rlang")
#install.packages("rlang", dependencies = TRUE)
library(rlang)
library(readr)

library(knitr)

# ============================================================
# 1) Importar e preparar os dados
# ============================================================
Vigitel <- read_csv("data/Vigitel-2023-peso-rake.csv")

Vigitel_mut <- Vigitel %>%
  mutate(
    # Confundidores
    idade_cat = factor(cut(q6, breaks = c(18, 35, 60, Inf), right = FALSE,
                           labels = c("18-34","35-59","60+"))),
    sexo = factor(q7, labels = c("Homem", "Mulher")),
    esc_cat   = factor(fesc),
    atividade_fisica = factor(q42, labels = c("Sim", "N√£o")),  # vari√°vel nova

    # Exposi√ß√£o: ultraprocessados
    upf_cat = factor(score_upp_2cat, labels = c("N√£o", "Sim")),

    # Desfecho: obesidade
    ob = factor(obesid, labels = c("N√£o", "Sim")),

    pesorake = as.numeric(pesorake)
  )

# ============================================================
# 2) Desenho amostral
# ============================================================
vigi_svy <- svydesign(
  id      = ~1,
  weights = ~pesorake,
  data    = Vigitel_mut
)

#proporcao de obesidade

#preval√™ncia global de obesidade
svyciprop(~I(ob=="Sim"), vigi_svy)
#aproximadamente 24% dos adultos s√£o obesos (IC95% 22,7‚Äì25,3%)

#preval√™ncia de obesidade por grupo de consumo de ultraprocessados
svyby(~I(ob=="Sim"),~upf_cat,design=vigi_svy, svyciprop,vartype="ci")
#obesidade em quem N√ÉO consome UPF: ~24,5% (IC95% 23,0‚Äì26,0%)
#obesidade em quem consome UPF: ~21,7% (IC95% 19,0‚Äì24,6%)
#obesidade ligeiramente MENOR entre consumidores de UPF (resultado bruto, ainda sem ajuste)

#preval√™ncia de obesidade por grupo de idade
svyby(~I(ob=="Sim"),~idade_cat,design=vigi_svy, svyciprop,vartype="ci")
#18‚Äì34 anos: 19,9% (IC95% 17,7‚Äì22,3%)
#35‚Äì59 anos: 27,8% (IC95% 25,9‚Äì29,8%)
#60+ anos: 23,4% (IC95% 21,1‚Äì25,9%)
#obesidade √© MAIS comum em 35‚Äì59 anos, intermedi√°ria em 60+ e MENOR em 18‚Äì34 anos

#preval√™ncia de consumo de ultraprocessados por grupo de idade
svyby(~I(upf_cat=="Sim"), ~idade_cat, design=vigi_svy, svyciprop, vartype="ci")
#18‚Äì34 anos: 24,3% consomem UPF (IC95% 22,1‚Äì26,7%)
#35‚Äì59 anos: 15,7% (IC95% 14,1‚Äì17,4%)
#60+ anos: 9,4% (IC95% 7,9‚Äì11,1%)
#consumo de UPF √© MAIS comum em jovens e cai bastante com a idade

#IMPORTANTE: tabela de conting√™ncia
tabela1_age <- table1(~ factor(Vigitel_mut$idade_cat) | Vigitel_mut$upf_cat, data = Vigitel_mut)
print(tabela1_age)

# ============================================================
# Remover missings - exposi√ß√£o, desfecho ou confundidores
# ============================================================
vigi_svy2 <- subset(vigi_svy, !is.na(ob) & !is.na(upf_cat))

# Preval√™ncia de obesidade por consumo de UPF
svyby(~I(ob=="Sim"), ~upf_cat, design=vigi_svy2, svyciprop, vartype="ci")

# Preval√™ncia de obesidade por idade
svyby(~I(ob=="Sim"), ~idade_cat, design=vigi_svy2, svyciprop, vartype="ci")

# Preval√™ncia de UPF por idade
svyby(~I(upf_cat=="Sim"), ~idade_cat, design=vigi_svy2, svyciprop, vartype="ci")

# ============================================================
# 3) Modelos
# ============================================================

# --- Modelo bruto
mbruto <- svyglm(I(ob=="Sim") ~ upf_cat,
                 design=vigi_svy,
                 subset = !is.na(ob) & !is.na(upf_cat),
                 family=quasipoisson)

# --- Ajustado por idade
m1 <- svyglm(I(ob=="Sim") ~ upf_cat + idade_cat,
             design=vigi_svy,
             subset = !is.na(ob) & !is.na(upf_cat),
             family=quasipoisson)

# --- Ajustado por sexo
m2 <- svyglm(I(ob=="Sim") ~ upf_cat + sexo,
             design=vigi_svy,
             subset = !is.na(ob) & !is.na(upf_cat),
             family=quasipoisson)

# --- Ajustado por escolaridade
m3 <- svyglm(I(ob=="Sim") ~ upf_cat + esc_cat,
             design=vigi_svy,
             subset = !is.na(ob) & !is.na(upf_cat),
             family=quasipoisson)

# --- Ajustado por atividade f√≠sica
m4 <- svyglm(I(ob=="Sim") ~ upf_cat + atividade_fisica,
             design=vigi_svy,
             subset = !is.na(ob) & !is.na(upf_cat) & !is.na(atividade_fisica),
             family=quasipoisson)

# --- Ajustado por idade + escolaridade + atividade f√≠sica
m5 <- svyglm(I(ob=="Sim") ~ upf_cat + idade_cat + esc_cat + atividade_fisica,
             design=vigi_svy,
             subset = !is.na(ob) & !is.na(upf_cat) & !is.na(atividade_fisica),
             family=quasipoisson)

# ============================================================
# 4) Tabela final com RP, IC95% e p-valor
# ============================================================
tab_final <- bind_rows(
  tidy(mbruto, conf.int=TRUE, exponentiate=TRUE) %>%
    filter(term=="upf_catSim") %>% mutate(Modelo="Bruta"),
  tidy(m1, conf.int=TRUE, exponentiate=TRUE) %>%
    filter(term=="upf_catSim") %>% mutate(Modelo="Ajustada por Idade"),
  tidy(m2, conf.int=TRUE, exponentiate=TRUE) %>%
    filter(term=="upf_catSim") %>% mutate(Modelo="Ajustada por Sexo"),
  tidy(m3, conf.int=TRUE, exponentiate=TRUE) %>%
    filter(term=="upf_catSim") %>% mutate(Modelo="Ajustada por Escolaridade"),
  tidy(m4, conf.int=TRUE, exponentiate=TRUE) %>%
    filter(term=="upf_catSim") %>% mutate(Modelo="Ajustada por Atividade F√≠sica"),
  tidy(m5, conf.int=TRUE, exponentiate=TRUE) %>%
    filter(term=="upf_catSim") %>% mutate(Modelo="Ajustada por Idade + Escolaridade + Atividade F√≠sica")
) %>%
  transmute(
    Modelo,
    `RP` = estimate,
    `IC95% (inferior)` = conf.low,
    `IC95% (superior)` = conf.high,
    `p-valor` = p.value
  )

# Renderizar tabela
gt_tab <- tab_final %>%
  mutate(
    RP = sprintf("%.2f", RP),
    `IC95% (inferior)` = sprintf("%.2f", `IC95% (inferior)`),
    `IC95% (superior)` = sprintf("%.2f", `IC95% (superior)`),
    `p-valor` = ifelse(`p-valor`<0.001, "<0,001",
                       sub("\\.", ",", sprintf("%.3f", `p-valor`)))
  ) %>%
  gt::gt() %>%
  gt::tab_header(title="Raz√µes de Preval√™ncia (RP) ‚Äì Obesidade vs Consumo de Ultraprocessados")


# ============================================================
# 5) DESFECHOS SECUND√ÅRIOS: Hipertens√£o e Diabetes
# ============================================================

# Recodificar vari√°veis (1=Sim, 2=N√£o) e descartar 777 ("n√£o sei")
Vigitel_mut <- Vigitel_mut %>%
  mutate(
    hipertensao = case_when(
      q75 %in% c(1,2) ~ factor(q75, levels=c(2,1), labels=c("N√£o","Sim")),
      TRUE ~ NA
    ),
    diabetes = case_when(
      q76 %in% c(1,2) ~ factor(q76, levels=c(2,1), labels=c("N√£o","Sim")),
      TRUE ~ NA
    )
  )

# Atualizar desenho com as novas vari√°veis
vigi_svy <- svydesign(
  id      = ~1,
  weights = ~pesorake,
  data    = Vigitel_mut
)

# ------------------------------------------------------------
# Fun√ß√£o auxiliar para rodar an√°lises por desfecho
# ------------------------------------------------------------
analise_desfecho <- function(desfecho, label){
  m_bruto <- svyglm(as.formula(paste0("I(", desfecho, "=='Sim') ~ upf_cat")),
                    design=vigi_svy,
                    subset = !is.na(get(desfecho)),
                    family=quasipoisson)

  m_ajust <- svyglm(as.formula(paste0("I(", desfecho, "=='Sim') ~ upf_cat + idade_cat + sexo + esc_cat + atividade_fisica")),
                    design=vigi_svy,
                    subset = !is.na(get(desfecho)),
                    family=quasipoisson)

  res <- bind_rows(
    tidy(m_bruto, conf.int=TRUE, exponentiate=TRUE) %>%
      filter(term=="upf_catSim") %>% mutate(Modelo="Bruto", Desfecho=label),
    tidy(m_ajust, conf.int=TRUE, exponentiate=TRUE) %>%
      filter(term=="upf_catSim") %>% mutate(Modelo="Ajustado", Desfecho=label)
  ) %>%
    transmute(
      Desfecho,
      Modelo,
      `RP` = estimate,
      `IC95% (inferior)` = conf.low,
      `IC95% (superior)` = conf.high,
      `p-valor` = p.value
    )
  return(res)
}

# ------------------------------------------------------------
# Rodar para cada desfecho secund√°rio
# ------------------------------------------------------------
res_obes   <- analise_desfecho("ob", "Obesidade")
res_hipert <- analise_desfecho("hipertensao", "Hipertens√£o")
res_diab   <- analise_desfecho("diabetes", "Diabetes")

# Juntar resultados
tab_secundarios <- bind_rows(res_obes,res_hipert, res_diab)

# Renderizar tabela
gt_tab2 <- tab_secundarios %>%
  mutate(
    RP = sprintf("%.2f", RP),
    `IC95% (inferior)` = sprintf("%.2f", `IC95% (inferior)`),
    `IC95% (superior)` = sprintf("%.2f", `IC95% (superior)`),
    `p-valor` = ifelse(`p-valor`<0.001, "<0,001",
                       sub("\\.", ",", sprintf("%.3f", `p-valor`)))
  ) %>%
  gt::gt() %>%
  gt::tab_header(title="Raz√µes de Preval√™ncia (RP) ‚Äì Consumo de Ultraprocessados e Doen√ßas Cr√¥nicas")

# ============================================================
# 6) Comparar com Modelos Log√≠sticos (OR)
# ============================================================

# ------------------------------------------------------------
# Fun√ß√£o auxiliar para rodar an√°lises log√≠sticas
# ------------------------------------------------------------
analise_logit <- function(desfecho, label){
  m_bruto <- svyglm(as.formula(paste0("I(", desfecho, "=='Sim') ~ upf_cat")),
                    design=vigi_svy,
                    subset = !is.na(get(desfecho)),
                    family=binomial(link="logit"))

  m_ajust <- svyglm(as.formula(paste0("I(", desfecho, "=='Sim') ~ upf_cat + idade_cat + sexo + esc_cat + atividade_fisica")),
                    design=vigi_svy,
                    subset = !is.na(get(desfecho)),
                    family=binomial(link="logit"))

  res <- bind_rows(
    tidy(m_bruto, conf.int=TRUE, exponentiate=TRUE) %>%
      filter(term=="upf_catSim") %>% mutate(Modelo="Bruto", Desfecho=label),
    tidy(m_ajust, conf.int=TRUE, exponentiate=TRUE) %>%
      filter(term=="upf_catSim") %>% mutate(Modelo="Ajustado", Desfecho=label)
  ) %>%
    transmute(
      Desfecho,
      Modelo,
      `OR` = estimate,
      `IC95% (inferior)` = conf.low,
      `IC95% (superior)` = conf.high,
      `p-valor` = p.value
    )
  return(res)
}

# ------------------------------------------------------------
# Rodar para obesidade, hipertens√£o e diabetes
# ------------------------------------------------------------
res_logit_ob   <- analise_logit("ob", "Obesidade")
res_logit_hip  <- analise_logit("hipertensao", "Hipertens√£o")
res_logit_diab <- analise_logit("diabetes", "Diabetes")

# Juntar resultados
tab_logit <- bind_rows(res_logit_ob, res_logit_hip, res_logit_diab)

# ------------------------------------------------------------
# Renderizar tabela de ORs
# ------------------------------------------------------------
gt_tab_logit <- tab_logit %>%
  mutate(
    OR = sprintf("%.2f", OR),
    `IC95% (inferior)` = sprintf("%.2f", `IC95% (inferior)`),
    `IC95% (superior)` = sprintf("%.2f", `IC95% (superior)`),
    `p-valor` = ifelse(`p-valor`<0.001, "<0,001",
                       sub("\\.", ",", sprintf("%.3f", `p-valor`)))
  ) %>%
  gt::gt() %>%
  gt::tab_header(title="Raz√µes de Chances (OR) ‚Äì Consumo de Ultraprocessados e Doen√ßas Cr√¥nicas")


```


## VIGITEL


**- Sistema de Vigil√¢ncia de Fatores de Risco e Prote√ß√£o para Doen√ßas Cr√¥nicas por Inqu√©rito Telef√¥nico -**

> **Objetivo:**
>
> > Monitorar anualmente a situa√ß√£o de sa√∫de da popula√ß√£o brasileira, por meio da distribui√ß√£o dos principais fatores de risco e prote√ß√£o para as DCNT's.

## Defini√ß√£o do problema

- **Hip√≥tese principal:** O consumo frequente de ultraprocessados est√° associado a maior preval√™ncia de **obesidade** em adultos brasileiros.

- **Justificativa:** Ultraprocessados s√£o reconhecidos pela literatura como fator de risco para doen√ßas cr√¥nicas (densidade energ√©tica, s√≥dio, gorduras trans/saturadas, aditivos).

## Conceito{.smaller}

:::: {.columns}

::: {.column width="40%"}

- Os alimentos ultraprocessados s√£o produtos industriais feitos com subst√¢ncias artificiais ou extra√≠das de alimentos. T√™m como caracter√≠stica serem **saborosos**, **pr√°ticos** e de **baixo custo**.

- Geralmente pobres em nutrientes e ricos em calorias, a√ß√∫car, gordura e aditivos qu√≠micos.

:::

::: {.column width="60%"}
![](images/ultraprocessados.png){}
:::

::::

## Motivadores
::: footer
:::

![](images/agbrasil.png){.absolute .fragment .fade-in-then-out top="80" left="0"}

![](images/veja.png){.absolute .fragment .fade-in-then-out top="80" left="0"}

![](images/fiocruz.png){.absolute .fragment .fade-in-then-out top="80" left="90"}

![](images/unicef.png){.absolute .fragment}

<!--

Referencias;

- https://agenciabrasil.ebc.com.br/saude/noticia/2020-11/consumo-de-alimentos-ultraprocessados-cresce-na-pandemia

- https://veja.abril.com.br/coluna/balanco-social/obesidade-e-consumo-de-ultraprocessados-avancam-entre-os-mais-pobres/

- https://www.ajpmonline.org/pb-assets/Health%20Advance/journals/amepre/Nilson-et-al-1667841500.pdf

- https://www.unicef.org/brazil/comunicados-de-imprensa/pela-primeira-vez-obesidade-supera-desnutricao-globalmente-entre-criancas-e-adolescentes-em-idade-escolar
-->

## Poss√≠veis confundimentos/vi√©ses

- Idade
- Sexo
- Escolaridade
- Atividade F√≠sica
- <span style="color: #b0b0b0;">Renda</span>
- <span style="color: #b0b0b0;">Predisposi√ß√£o Gen√©tica</span>

# Vari√°veis

## Exposi√ß√£o:

- Consumo de 5 ou mais grupos de alimentos ultraprocessados.
- Vari√°veis Relacionadas: consumo de refrigerante, embutidos, biscoitos recheados, fast food...
![](images/grupos.png){.absolute}

## Desfechos:

- **Obesidade**: IMC ‚â• 30

$$
IMC = \frac{peso(kg)}{altura(m)^2}
$$

## Confundidores candidatos:

  - Sociodemogr√°ficos: **idade**, **sexo**, **escolaridade**
  - Comportamentais: **atividade f√≠sica**

## An√°lise de preval√™ncia global{.smaller}

::: {.panel-tabset}

### Obesidade
```{r, analise-prevalencia-global}
#| echo: TRUE

#preval√™ncia global de obesidade

svyciprop(~I(ob=="Sim"), vigi_svy)
#aproximadamente 24% dos adultos s√£o obesos (IC95% 22,7‚Äì25,3%)
```

### UPF
```{r}
#| echo: TRUE

#preval√™ncia de obesidade por grupo de consumo de ultraprocessados
svyby(~I(ob=="Sim"),~upf_cat,design=vigi_svy, svyciprop,vartype="ci")
#obesidade em quem N√ÉO consome UPF: ~24,5% (IC95% 23,0‚Äì26,0%)
#obesidade em quem consome UPF: ~21,7% (IC95% 19,0‚Äì24,6%)
#obesidade ligeiramente MENOR entre consumidores de UPF (resultado bruto, ainda sem ajuste)
```

### Obesidade(Grupo)
```{r}
#| echo: TRUE

#preval√™ncia de obesidade por grupo de idade
svyby(~I(ob=="Sim"),~idade_cat,design=vigi_svy, svyciprop,vartype="ci")
#18‚Äì34 anos: 19,9% (IC95% 17,7‚Äì22,3%)
#35‚Äì59 anos: 27,8% (IC95% 25,9‚Äì29,8%)
#60+ anos: 23,4% (IC95% 21,1‚Äì25,9%)
#obesidade √© MAIS comum em 35‚Äì59 anos, intermedi√°ria em 60+ e MENOR em 18‚Äì34 anos
```

### UPF(Grupo)
```{r}
#| echo: TRUE

#preval√™ncia de consumo de ultraprocessados por grupo de idade
svyby(~I(upf_cat=="Sim"), ~idade_cat, design=vigi_svy, svyciprop, vartype="ci")
#18‚Äì34 anos: 24,3% consomem UPF (IC95% 22,1‚Äì26,7%)
#35‚Äì59 anos: 15,7% (IC95% 14,1‚Äì17,4%)
#60+ anos: 9,4% (IC95% 7,9‚Äì11,1%)
#consumo de UPF √© MAIS comum em jovens e cai bastante com a idade

```

:::

## Modelo Estat√≠stico{.smaller}

:::footer
:::

üîπ Por que usamos modelos de regress√£o neste estudo?

üîπ Para estimar a Raz√£o de Preval√™ncia utilizamos a **Regress√£o de Poisson** com vari√¢nca robusta.

üîπ **Raz√£o de Preval√™ncia** √© a medida de associa√ß√£o recomendada para estudos transversais com desfechos n√£o raros (obesidade). Usando **_Odds Ratio_** superestimar√≠amos a magnitude de associa√ß√£o.

üîπ Interpreta√ß√£o direta: "consumidores de UPF t√™m x% mais/menos preval√™ncia de obesidade comparados aos n√£o consumidores".


## Modelo Estat√≠stico

::: {style="display: flex; justify-content: space-around; align-items: center;"}

![](images/modelo-1.png){.absolute   top="80" left="150" width="650"}
![](images/modelo-2.png){.absolute .fragment top="150" left="200" width="850"}

:::

## Resultados
```{r resultados}
gt_tab
```

## Resultados
:::: {.columns}

::: {.column width="50%"}
```{r resultados2}
gt_tab2
```

:::

::: {.column width="50%"}

```{r resultados3}
gt_tab_logit
```

:::

::::

## Conclus√µes{.smaller}

1. Obesidade

- Tanto os modelos de Raz√£o de Preval√™ncia (RP) quanto os de Raz√£o de Chances (OR) n√£o mostraram associa√ß√£o estatisticamente significativa entre consumo de ultraprocessados e obesidade, ap√≥s ajustes por idade.

- As estimativas (RP ~0,88‚Äì0,92; OR ~0,85‚Äì0,87) sugerem uma tend√™ncia de menor obesidade entre consumidores de ultraprocessados, mas isso provavelmente reflete vi√©s de confus√£o residual (por exemplo, maior consumo entre jovens, que t√™m menor obesidade).

## Conclus√µes{.smaller}

2. Hipertens√£o e Diabetes

- Nos modelos brutos, consumidores de ultraprocessados apresentaram menor preval√™ncia/chance de hipertens√£o e diabetes (RP e OR < 1, p < 0,001).

- Contudo, ap√≥s ajuste pelos confundidores, a associa√ß√£o desaparece (RP e OR pr√≥ximas de 1, com IC95% abrangendo 1 e p > 0,1).

- Isso indica que a diferen√ßa inicial era explicada pelo perfil sociodemogr√°fico particularmente idade: **os jovens consomem mais ultraprocessados, mas ainda n√£o desenvolveram tantas doen√ßas cr√¥nicas**

## Conclus√µes{.smaller}

3. Compara√ß√£o OR vs RP

- Os resultados de OR e RP foram consistentes em termos de dire√ß√£o do efeito: ambos sugerem aus√™ncia de associa√ß√£o ap√≥s ajuste.

- Por√©m, como esperado, os OR tenderam a superestimar a for√ßa da associa√ß√£o no modelo bruto (ex.: OR=0,61 para hipertens√£o vs RP=0,69).

- Isso confirma que a escolha pelo modelo de RP (quasipoisson ou log-binomial) √© mais adequada em estudos transversais de preval√™ncia.

## Fechamento{.smaller}

- N√£o encontramos associa√ß√£o significativa entre consumo de ultraprocessados e obesidade, hipertens√£o ou diabetes na amostra ap√≥s controle de confundidores.

- Os achados brutos sugeriam um "efeito protetor" dos ultraprocessados. No entanto, esse achado √© viesado pelo perfil et√°rio dos consumidores (mais jovens, com menor risco imediato de doen√ßas cr√¥nicas).

- Esses resultados **n√£o devem ser interpretados como aus√™ncia de risco** dos ultraprocessados. A literatura j√° mostra evid√™ncias s√≥lidas de que ultraprocessados aumentam o risco de obesidade, s√≠ndrome metab√≥lica, diabetes tipo 2 e doen√ßas cardiovasculares, mas esses efeitos s√£o **cumulativos e se manifestam ao longo do tempo.**

- Assim, o nosso estudo ilustra uma limita√ß√£o t√≠pica de estudos transversais: o vi√©s da idade e a dificuldade de captar efeitos de longo prazo.

# Obrigado pela aten√ß√£o!
